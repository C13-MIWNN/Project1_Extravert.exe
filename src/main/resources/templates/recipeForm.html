<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head th:replace="~{fragments/general :: baseHeader(~{:: title})}">
    <title>Create a recipe</title>
</head>
<body>
<div th:replace="~{fragments/general :: logo}"></div>
<div th:replace="~{fragments/general :: navbar}"></div>

<div class="container">

    <h1>Create a recipe</h1>


    <form th:action="@{/recipe/new}" method="post" th:object="${recipe}">
        <table class="table">
            <thead class="thead-light">
            <tr>
                <th scope="col"><label for="nameField">Add a name:</label></th>
                <th scope="col"><label for="servingsField">Number of servings:</label></th>
                <th scope="col"><label for="preparationTimeField">Preparation Time</label></th>
                <th scope="col"><label for="TagField">Tags:</label></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><input type="text" id="nameField" class="form-control" th:field="*{name}" /></td>
                <td><input type="text" id="servingsField" class="form-control" th:field="*{numberOfServings}" /></td>
                <td>
                    <select id="preparationTimeField" class="form-control" th:field="*{preparationTime}">
                        <option value="15 min">15 min</option>
                        <option value="30 min">30 min</option>
                        <option value="60 min">60 min</option>
                        <option value="1 uur 30 min">1 uur 30 min</option>
                        <option value="1 uur 30 min+">1 uur 30 min+</option>
                    </select>
                </td>
                <td>
                    <select id="TagField" class="form-control" th:field="*{tags}" multiple>
                        <option th:each="tag : ${allTags}" th:value="${tag.tagId}" th:text="${tag.nameTag}"></option>
                    </select>
                </td>
            </tr>
            </tbody>
        </table>

        <h3>Ingredients</h3>
        <table class="table" id="ingredientTable">
            <thead class="thead-light">
            <tr>
                <th scope="col"><label for="ingredientsField">Ingredients:</label></th>
                <th scope="col"><label for="ingredientAmountField">Amount:</label></th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td >
                    <select class="form-control" id="ingredientsField">
                        <option th:each="ingredient : ${allIngredients}" th:value="${ingredient.ingredientId}"
                                th:text="${ingredient.name + ' ' + ingredient.unit.value}"></option>
                    </select>
                </td>
                <td><input class="form-control" type="text" id="ingredientAmountField"></td>
                <td>
                    <button type="button" onclick="addIngredient()" class="btn btn-secondary btn-sm">Add Ingredient</button>
                </td>
            </tr>
            </tbody>
        </table>


        <div id="addedIngredients" class="form-control"></div>

        <h3>Directions</h3>
        <p>Click on "Next step" to add step-by-step directions to your recipe</p>
        <table id="stepsTable">
            <tr>
                <td><label for="recipeStepInput">Steps:</label></td>
            </tr>
            <tr th:each="step, index : *{recipeSteps}">
                <td><input type="text" id="recipeStepInput" class="form-control"
                           th:field="*{recipeSteps[__${index.index}__]}" size="100"/>
                </td>
            </tr>
        </table>
        <button type="button" onclick="addStep()" class="btn btn-secondary btn-sm">Next step</button>
        <div>
            <button type="submit" id="submitButton" class="btn btn-secondary btn-lg btn-block">Save recipe</button>
        </div>
    </form>

    <script>
        function addIngredient() {
            let ingredientId = document.getElementById("ingredientsField").value;
            let ingredientName = document.getElementById("ingredientsField")
                .options[document.getElementById("ingredientsField").selectedIndex].text;
            let amount = document.getElementById("ingredientAmountField").value;
            let displayDiv = document.getElementById("addedIngredients");

            let p = document.createElement("p");
            p.textContent = ingredientName + ": " + amount;
            displayDiv.appendChild(p);

            let inputIngredientId = document.createElement("input");
            inputIngredientId.type = "hidden";
            inputIngredientId.name = "selectedIngredients";
            inputIngredientId.value = ingredientId;

            let inputAmount = document.createElement("input");
            inputAmount.type = "hidden";
            inputAmount.name = "ingredientAmounts";
            inputAmount.value = amount;

            displayDiv.appendChild(inputIngredientId);
            displayDiv.appendChild(inputAmount);
        }
    </script>



    <script th:inline="javascript">
        function addStep() {
            let stepsTable = document.getElementById('stepsTable');
            let newRow = stepsTable.insertRow(-1);
            let cell = newRow.insertCell(0);

            let newInput = document.createElement('input');
            newInput.setAttribute('type', 'text');
            newInput.setAttribute('name', 'recipeSteps');
            cell.appendChild(newInput);
        }
    </script>
</div>

<div th:replace="~{fragments/general :: footer}"></div>
<div th:replace="~{fragments/general :: bottomScripts}"></div>

</body>
</html>
