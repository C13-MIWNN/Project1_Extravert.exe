<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head th:replace="~{fragments/general :: baseHeader(~{:: title})}">
    <title>Put a title here!</title>
</head>
<body>

<div th:replace="~{fragments/general :: navbar}"></div>

<div class="container">

    <h1>edit a recipe</h1>

    <form th:action="@{'/recipe/' + ${recipe.recipeId} + '/edit'}" method="post" th:object="${recipe}">
        <input type="hidden" th:field="*{recipeId}">
        <input type="hidden" id="removedIngredients" name="removedIngredients" />
        <table>
            <tr>
                <td><label for="nameField">Add a name:</label></td>
                <td><label for="servingsField">Number of servings:</label></td>
                <td><label for="ingredientsField">Ingredients:</label></td>
                <td><label for="ingredientAmountField">Amount:</label></td>
                <td><label for="preparationTimeField">Preparation Time</label></td>
                <td><label for="TagField">Tags:</label></td>



            </tr>
            <tr>
                <td><input type="text" id="nameField" th:field="*{name}" /></td>
                <td><input type="text" id="servingsField" th:field="*{numberOfServings}" /></td>
                <td>
                    <select id="ingredientsField">
                        <option th:each="ingredient : ${allIngredients}" th:value="${ingredient.ingredientId}"
                                th:text="${ingredient.name + ' ' + ingredient.unit.value}"></option>
                    </select>
                </td>
                <td><input type="text" id="ingredientAmountField"></td>

                <td>
                    <select id="preparationTimeField" th:field="*{preparationTime}">
                        <option value="15 min">15 min</option>
                        <option value="30 min">30 min</option>
                        <option value="60 min">60 min</option>
                        <option value="1 uur 30 min">90 min</option>
                        <option value="langer dan 1 uur 30 min">90+ min</option>
                    </select>
                </td>
                <td>
                    <select id="TagField" th:field="*{tags}" multiple>
                        <option th:each="tag : ${allTags}" th:value="${tag.tagId}" th:text="${tag.nameTag}"></option>
                    </select>
                </td>
            </tr>
        </table>

        <h2>Already Added Ingredients:</h2>
        <table id="ingredientTable">
            <tr th:each="recipeIngredient : ${recipe.ingredients}">
                <td th:text="${recipeIngredient.ingredient.name + ' ' + recipeIngredient.ingredient.unit.value}"></td>
                <td th:text="${recipeIngredient.amount}"></td>
                <td>
                    <form th:action="@{'/recipeIngredient/delete/{id}'(id=${recipeIngredient.recipeIngredientId})}"
                          method="post" style="display: inline;">
                        <input type="hidden" th:method="DELETE" value="DELETE" />
                        <button type="submit">Remove</button>
                    </form>
                </td>
            </tr>
        </table>

        <table>
            <tr>
                <form th:action="@{'/recipe/' + ${recipe.recipeId} + '/add-ingredient'}" method="post" id="addIngredientForm">
                    <input type="hidden" id="ingredientIdField" name="ingredientId" />
                    <input type="hidden" id="amountField" name="amount" />
                    <button type="button" onclick="addIngredient()">Add Ingredient</button>
                </form>
            </tr>
        </table>


        <div id="addedIngredients"></div>

        <h2>Directions
        </h2>
        <p>Click on "Next step" to add step-by-step directions to your recipe</p>
        <table id="stepsTable">
            <td><label for="recipeStepInput">Steps:</label></td>
            <button type="button" onclick="addStep()">Next step</button>
            <tr th:each="step, index : *{recipeSteps}">
                <td><input type="text" id="recipeStepInput"
                           th:field="*{recipeSteps[__${index.index}__]}" size="100"/>
                </td>
            </tr>
        </table>
        <div>
            <button type="submit" id="submitButton" class="btn btn-secondary btn-lg btn-block">Save recipe</button>
        </div>
    </form>

    <script>
        function addIngredient() {
            var ingredientId = document.getElementById("ingredientsField").value;
            var amount = document.getElementById("ingredientAmountField").value;

            document.getElementById("ingredientIdField").value = ingredientId;

            document.getElementById("amountField").value = amount;

            document.getElementById("addIngredientForm").submit();
        }
    </script>

    <script th:inline="javascript">
        function addStep() {
            var stepsTable = document.getElementById('stepsTable');
            var newRow = stepsTable.insertRow(-1);
            var cell = newRow.insertCell(0);

            var newInput = document.createElement('input');
            newInput.setAttribute('type', 'text');
            newInput.setAttribute('name', 'recipeSteps');
            cell.appendChild(newInput);
        }
    </script>



</div>

<div th:replace="~{fragments/general :: footer}"></div>
<div th:replace="~{fragments/general :: bottomScripts}"></div>

</body>
</html>